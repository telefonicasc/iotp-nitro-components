// ==========================================
// Copyright 2013 Twitter, Inc
// Licensed under The MIT License
// http://opensource.org/licenses/MIT
// ==========================================

//implementation lifted from underscore.js (c) 2009-2012 Jeremy Ashkenas

define("libs/flight/lib/utils",[],function(){var e=[],t=100,n={isDomObj:function(e){return!!e.nodeType||e===window},toArray:function(t,n){return e.slice.call(t,n)},merge:function(){var e=this.toArray(arguments);return e.unshift({}),e[e.length-1]===!0&&(e.pop(),e.unshift(!0)),$.extend.apply(undefined,e)},push:function(e,t,n){return e&&Object.keys(t||{}).forEach(function(r){if(e[r]&&n)throw Error("utils.push attempted to overwrite '"+r+"' while running in protected mode");typeof e[r]=="object"&&typeof t[r]=="object"?this.push(e[r],t[r]):e[r]=t[r]},this),e},isEnumerable:function(e,t){return Object.keys(e).indexOf(t)>-1},compose:function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},uniqueArray:function(e){var t={},n=[];for(var r=0,i=e.length;r<i;++r){if(t.hasOwnProperty(e[r]))continue;n.push(e[r]),t[e[r]]=1}return n},debounce:function(e,n,r){typeof n!="number"&&(n=t);var i,s;return function(){var t=this,o=arguments,u=function(){i=null,r||(s=e.apply(t,o))},a=r&&!i;return clearTimeout(i),i=setTimeout(u,n),a&&(s=e.apply(t,o)),s}},throttle:function(e,n){typeof n!="number"&&(n=t);var r,i,s,o,u,a,f=this.debounce(function(){u=o=!1},n);return function(){r=this,i=arguments;var t=function(){s=null,u&&(a=e.apply(r,i)),f()};return s||(s=setTimeout(t,n)),o?u=!0:(o=!0,a=e.apply(r,i)),f(),a}},countThen:function(e,t){return function(){if(!--e)return t.apply(this,arguments)}},delegate:function(e){return function(t,n){var r=$(t.target),i;Object.keys(e).forEach(function(s){if((i=r.closest(s)).length)return n=n||{},n.el=i[0],e[s].apply(this,[t,n])},this)}}};return n}),define("libs/flight/lib/registry",["./utils"],function(e){function t(t,n){var r,i,s;return n=e.toArray(n),typeof n[n.length-1]=="function"&&(s=n.pop()),typeof n[n.length-1]=="object"&&n.pop(),n.length==2?(r=n[0],i=n[1]):(r=t.node,i=n[0]),{element:r,type:i,callback:s}}function n(e,t){return e.element==t.element&&e.type==t.type&&(t.callback==null||e.callback==t.callback)}function r(){function i(e){this.component=e,this.instances=[],this.addInstance=function(e){this.throwIfInstanceExistsOnNode(e);var t=new s(e);return this.instances.push(t),t},this.throwIfInstanceExistsOnNode=function(e){this.instances.forEach(function(t){if(t.instance.$node[0]===e.$node[0])throw new Error("Instance of "+e.constructor+" already exists on node "+e.$node[0])})},this.removeInstance=function(e){var t=this.instances.filter(function(t){return t.instance==e})[0],n=this.instances.indexOf(t);n>-1&&this.instances.splice(n,1),this.instances.length||r.removeComponentInfo(this)}}function s(e){this.instance=e,this.events=[],this.addTrigger=function(){},this.addBind=function(e){this.events.push(e),r.events.push(e)},this.removeBind=function(e){for(var t=0,r;r=this.events[t];t++)n(r,e)&&this.events.splice(t,1)}}var r=this;(this.reset=function(){this.components=[],this.allInstances=[],this.events=[]}).call(this),this.addInstance=function(e){var t=this.findComponentInfo(e);t||(t=new i(e.constructor),this.components.push(t));var n=t.addInstance(e);return this.allInstances.push(n),t},this.removeInstance=function(e){var t,n=this.findInstanceInfo(e),r=this.findComponentInfo(e);r.removeInstance(e);var t=this.allInstances.indexOf(n);t>-1&&this.allInstances.splice(t,1)},this.removeComponentInfo=function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},this.findComponentInfo=function(e){var t=e.attachTo?e:e.constructor;for(var n=0,r;r=this.components[n];n++)if(r.component===t)return r;return null},this.findInstanceInfo=function(e){var t;e.node?t=function(t){return t.instance===e}:t=function(t){return t.instance.node===e};var n=this.allInstances.filter(t);return n.length?e.node?n[0]:n:e.node?null:[]},this.trigger=function(){var e=t(this,arguments),n=r.findInstanceInfo(this);n&&n.addTrigger(e)},this.on=function(n){var i=e.toArray(arguments,1),s=r.findInstanceInfo(this),o;if(s){o=n.apply(null,i),o&&(i[i.length-1]=o);var u=t(this,i);s.addBind(u)}},this.off=function(e,n,i){var s=t(this,arguments),o=r.findInstanceInfo(this);o&&o.removeBind(s)},this.teardown=function(){r.removeInstance(this)},this.withRegistration=function(){this.before("initialize",function(){r.addInstance(this)}),this.after("trigger",r.trigger),this.around("on",r.on),this.after("off",r.off),this.after("teardown",{obj:r,fnName:"teardown"})}}return new r}),define("libs/flight/tools/debug/debug",["../../lib/registry","../../lib/utils"],function(e,t){function r(e,t,n){var n=n||{},i=n.obj||window,o=n.path||(i==window?"window":""),u=Object.keys(i);u.forEach(function(n){(s[e]||e)(t,i,n)&&console.log([o,".",n].join(""),"->",["(",typeof i[n],")"].join(""),i[n]),Object.prototype.toString.call(i[n])=="[object Object]"&&i[n]!=i&&o.split(".").indexOf(n)==-1&&r(e,t,{obj:i[n],path:[o,n].join(".")})})}function i(e,t,n,i){!t||typeof n==t?r(e,n,i):console.error([n,"must be",t].join(" "))}function o(e,t){i("name","string",e,t)}function u(e,t){i("nameContains","string",e,t)}function a(e,t){i("type","function",e,t)}function f(e,t){i("value",null,e,t)}function l(e,t){i("valueCoerced",null,e,t)}function c(e,t){r(e,null,t)}function p(){var e=[].slice.call(arguments,0);n.eventNames.length||(n.eventNames="all"),n.actions=e.length?e:"all"}function d(){var e=[].slice.call(arguments,0);n.actions.length||(n.actions="all"),n.eventNames=e.length?e:"all"}function v(){n.actions=[],n.eventNames=[]}function m(){n.actions="all",n.eventNames="all"}var n,s={name:function(e,t,n){return e==n},nameContains:function(e,t,n){return n.indexOf(e)>-1},type:function(e,t,n){return t[n]instanceof e},value:function(e,t,n){return t[n]===e},valueCoerced:function(e,t,n){return t[n]==e}},h="all";return n={actions:h,eventNames:h},{enable:function(e){this.enabled=!!e,e&&window.console&&(console.info("Booting in DEBUG mode"),console.info("You can filter event logging with DEBUG.events.logAll/logNone/logByName/logByAction")),window.DEBUG=this},find:{byName:o,byNameContains:u,byType:a,byValue:f,byValueCoerced:l,custom:c},events:{logFilter:n,logByAction:p,logByName:d,logAll:m,logNone:v}}}),define("libs/flight/lib/compose",["./utils","../tools/debug/debug"],function(e,t){function s(e,t){if(!n)return;var i=Object.create(null);Object.keys(e).forEach(function(n){if(r.indexOf(n)<0){var s=Object.getOwnPropertyDescriptor(e,n);s.writable=t,i[n]=s}}),Object.defineProperties(e,i)}function o(e,t,r){var i;if(!n||!e.hasOwnProperty(t)){r.call(e);return}i=Object.getOwnPropertyDescriptor(e,t).writable,Object.defineProperty(e,t,{writable:!0}),r.call(e),Object.defineProperty(e,t,{writable:i})}function u(e,t){e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],t.forEach(function(t){e.mixedIn.indexOf(t)==-1&&(s(e,!1),t.call(e),e.mixedIn.push(t))}),s(e,!0)}var n=t.enabled&&!e.isEnumerable(Object,"getOwnPropertyDescriptor"),r=["mixedIn"];if(n)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(i){n=!1}return{mixin:u,unlockProperty:o}}),define("libs/flight/lib/advice",["./utils","./compose"],function(e,t){var n={around:function(t,n){return function(){var r=e.toArray(arguments);return n.apply(this,[t.bind(this)].concat(r))}},before:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i;return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),r.apply(this,t)})},after:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i,s=(r.unbound||r).apply(this,t);return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),s})},withAdvice:function(){["before","after","around"].forEach(function(e){this[e]=function(r,i){t.unlockProperty(this,r,function(){return typeof this[r]=="function"?this[r]=n[e](this[r],i):this[r]=i})}},this)}};return n}),define("libs/flight/lib/component",["./advice","./utils","./compose","./registry"],function(e,t,n,r){function o(e){e.events.slice().forEach(function(e){var t=[e.type];e.element&&t.unshift(e.element),typeof e.callback=="function"&&t.push(e.callback),this.off.apply(this,t)},e.instance)}function u(){this.trigger("componentTearDown"),o(r.findInstanceInfo(this))}function a(){var e=r.findComponentInfo(this);e&&e.instances.slice().forEach(function(e){e.instance.teardown()})}function f(e,t){try{window.postMessage(t,"*")}catch(n){throw console.log("unserializable data for event",e,":",t),new Error(["The event",e,"on component",this.describe,"was triggered with non-serializable data"].join(" "))}}function l(){this.trigger=function(){var e,n,r,i,s,o=t.toArray(arguments),u=o[o.length-1];typeof u!="string"&&(!u||!u.defaultBehavior)&&(r=o.pop()),e=o.length==2?$(o.shift()):this.$node,i=o[0],i.defaultBehavior&&(s=i.defaultBehavior,i=$.Event(i.type)),n=i.type||i,window.DEBUG&&window.postMessage&&f.call(this,n,r),typeof this.attr.eventData=="object"&&(r=$.extend(!0,{},this.attr.eventData,r));var a=e.trigger(i||n,r);return s&&!i.isDefaultPrevented()&&(this[s]||s).call(this),a},this.on=function(){var e,n,r,i,s=t.toArray(arguments);typeof s[s.length-1]=="object"?i=t.delegate(this.resolveDelegateRules(s.pop())):i=s.pop(),e=s.length==2?$(s.shift()):this.$node,n=s[0];if(typeof i!="function"&&typeof i!="object")throw new Error("Unable to bind to '"+n+"' because the given callback is not a function or an object");return r=i.bind(this),r.target=i,i.guid&&(r.guid=i.guid),e.on(n,r),i.guid=r.guid,r},this.off=function(){var e,n,r,i=t.toArray(arguments);return typeof i[i.length-1]=="function"&&(r=i.pop()),e=i.length==2?$(i.shift()):this.$node,n=i[0],e.off(n,r)},this.resolveDelegateRules=function(e){var t={};return Object.keys(e).forEach(function(n){if(!this.attr.hasOwnProperty(n))throw new Error('Component "'+this.describe+'" wants to listen on "'+n+'" but no such attribute was defined.');t[this.attr[n]]=e[n]},this),t},this.defaultAttrs=function(e){t.push(this.defaults,e,!0)||(this.defaults=e)},this.select=function(e){return this.$node.find(this.attr[e])},this.initialize=$.noop,this.teardown=u}function c(e){if(!e)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");var n=t.merge.apply(t,t.toArray(arguments,1));$(e).each(function(e,t){new this(t,n)}.bind(this))}function h(){function u(e,n){var r={},i=0;if(!e)throw new Error("Component needs a node");e.jquery?(this.node=e[0],this.$node=e):(this.node=e,this.$node=$(e)),this.describe=this.constructor.describe,this.bind=function(e){var n;if(e.uuid&&(n=r[e.uuid]))return n;var s=t.toArray(arguments,1);return s.unshift(this),n=e.bind.apply(e,s),n.target=e,e.uuid=i++,r[e.uuid]=n,n},this.attr=t.merge(this.defaults,n),this.defaults&&Object.keys(this.defaults).forEach(function(e){if(this.defaults[e]===null&&this.attr[e]===null)throw new Error('Required attribute "'+e+'" not specified in attachTo for component "'+this.describe+'".')},this),this.initialize.call(this,n||{}),this.trigger("componentInitialized")}var o=t.toArray(arguments);return u.toString=function(){var e=o.map(function(e){if($.browser.msie){var t=e.toString().match(i);return t&&t[1]?t[1]:""}return e.name}).join(", ").replace(s,"");return e},u.describe=u.toString(),u.attachTo=c,u.teardownAll=a,o.unshift(l,e.withAdvice,r.withRegistration),n.mixin(u.prototype,o),u}var i=/function (.*?)\s?\(/,s=/\s\,/g;return h.teardownAll=function(){r.components.slice().forEach(function(e){e.component.teardownAll()}),r.reset()},h}),define("components/component_manager",["libs/flight/lib/component"],function(e){var t={},n={create:function(){var n=Array.prototype.shift.call(arguments);return t[n]={mixins:arguments,component:e.apply(this,arguments)},t[n].component},extend:function(){var e=Array.prototype.shift.call(arguments),n=Array.prototype.shift.call(arguments);return t[n]={mixins:""},t[n].component},get:function(e){return t[e].component},each:function(e){$.each(t,function(t,n){e(t,n.component)})}};return n}),define("components/mixin/data_binding",[],function(){function e(){this.defaultAttrs({model:""}),this.after("initialize",function(){this.$node.attr("data-bind",""),this.on("changeData",function(e,t,n){t==="value"&&this.trigger("valueChange",{value:n})}),this.on("parentChange",function(e,t){var n=this.attr.model,r=t.value;n&&($.isFunction(n)?r=n(r):$.isPlainObject(n)?r=n:r=r[n]),e.stopPropagation(),this.$node.trigger("valueChange",{value:r,silent:!0})}),this.on("valueChange",function(e,t){var n=t.value,r=this.$node.find("[data-bind] [data-bind]");this.$node.find("[data-bind]").not(r).each(function(){$(this).trigger("parentChange",{value:n})}),t.silent&&e.stopPropagation()})})}return e}),define("components/mixin/template",["components/component_manager"],function(e){function t(){this.after("initialize",function(){this.attr.tpl&&(this.compiledTpl=Hogan.compile(this.attr.tpl),this.$node.html(this.compiledTpl.render(this.attr)),this.attr.components&&$.each(this.attr.components,$.proxy(function(t,n){e.get(n).attachTo(t)},this)),this.on("valueChange",function(e,t){var n=$.extend({value:t.value},this.attr);$.each(n,function(e,r){$.isFunction(r)&&(n[e]=r(t.value))}),this.$node.html(this.compiledTpl.render(n))}))})}return t}),define("components/component",["components/component_manager","components/mixin/data_binding","components/mixin/template"],function(e,t,n){return e.create("component",t,n)}),define("components/mixin/container",["components/component_manager","components/component"],function(e){function t(){this.renderItems=function(){$.each(this.attr.items,$.proxy(function(t,n){var r=$("<"+(n.tag||"div")+">");n.className&&r.addClass(n.className),n.html&&r.html(n.html),n.style&&r.css(n.style),$.isArray(n.component)?$.each(n.component,$.proxy(function(t,i){e.get(i).attachTo(r,n)},this)):n.component?e.get(n.component).attachTo(r,n):n.items?e.get("container").attachTo(r,n):e.get("component").attachTo(r,n),this.attr.insertionPoint?r.appendTo($(this.attr.insertionPoint,this.$node)):r.appendTo(this.$node),r.on("render",function(){return!1}),this.rendered?r.trigger("render"):this.on("render",function(){return r.trigger("render"),!1})},this))},this.after("initialize",function(){this.attr.items=this.attr.items||[],this.renderItems(),this.on("render",function(){this.rendered=!0}),jQuery.contains(document.documentElement,this.node)&&this.trigger("render")})}return t}),define("components/container",["components/component_manager","components/mixin/container"],function(e,t){return e.create("container",t)}),define("components/context_menu_panel",["components/component_manager"],function(e){function t(){this.defaultAttrs({}),this.after("initialize",function(){var t;this.attr.text&&(t=$("<li>").html(this.attr.text).addClass("context-menu-title").on("click",$.proxy(function(){this.trigger("back")},this)).appendTo(this.$node),this.attr.hasBack&&t.addClass("back-link"),$('<li class="separator">').appendTo(this.$node)),$.each(this.attr.items,$.proxy(function(t,n){var r=$("<li>").html(n.text).appendTo(this.$node);n.text==="--"?(r.html(""),r.addClass("separator")):(n.items&&r.addClass("submenu"),n.component&&e.get(n.component).attachTo(r),n.className&&r.addClass(n.className),r.on("click",$.proxy(function(){this.trigger("selected",n)},this)))},this))})}return e.create("contextMenuPanel",t)}),define("components/context_menu",["components/component_manager","components/context_menu_panel"],function(e,t){function n(){var e=[];this.defaultAttrs({items:[]}),this.after("initialize",function(){this.panelWrapper=$("<div>").addClass("context-menu-wrapper"),this.panelContainer=$("<div>").addClass("context-menu-container"),this.$node.addClass("context-menu"),this.$node.append($('<div class="tooltip-arrow">')),this.panelWrapper.append(this.panelContainer),this.$node.append(this.panelWrapper),this.on("show",function(t){e=[],this.panelContainer.find("ul").remove(),this.$node.show(),this.pushPanel(this.attr),this.panelWrapper.css({height:"auto"}),t.stopPropagation()}),this.on("hide",function(e){this.$node.hide(),e.stopPropagation()}),this.on("back",function(e){this.popPanel(),e.stopPropagation()}),this.on("selected",function(e,t){t.items?this.pushPanel(t):this.attr.onSelect&&this.attr.onSelect(t)}),this.pushPanel(this.attr)}),this.pushPanel=function(n){var r=$("<ul>");t.attachTo(r,$.extend({hasBack:e.length>0},n)),e.length?this.transitionPanel(r,this.panelContainer.find("ul")):this.panelContainer.append(r),e.push(n)},this.popPanel=function(){var n=$("<ul>");e.pop(),t.attachTo(n,e[e.length-1]),this.transitionPanel(n,this.panelContainer.find("ul"),!0)},this.transitionPanel=function(e,t,n){this.panelWrapper.css({height:this.panelWrapper.height()}),n?(e.insertBefore(t),this.panelContainer.css({marginLeft:0-e.width()})):e.insertAfter(t),this.panelContainer.css({width:1e4}),newHeight=this.$node.height(),this.panelContainer.animate({marginLeft:n?0:0-this.panelWrapper.width()},{complete:$.proxy(function(){t.remove(),this.panelContainer.css({width:"auto",marginLeft:0}),this.panelWrapper.animate({height:this.panelContainer.height()},250)},this)})}}return e.create("contextMenu",n)}),define("components/context_menu_indicator",["components/component_manager","components/context_menu"],function(e,t){function n(){this.defaultAttrs({}),this.updatePosition=function(){var e=this.$node.offset();this.$cm.css({top:e.top,left:e.left+this.$node.width()})},this.after("initialize",function(){this.$node.addClass("context-menu-indicator"),this.$cm=$("<div>").appendTo($("body")),t.attachTo(this.$cm,this.attr.contextMenu),$(window).on("resize",$.proxy(function(){this.$cm.is(":visible")&&this.updatePosition()},this)),this.$node.click($.proxy(function(){var e=this.$node.offset(),t=this.$node.width(),n=this.$cm.width(),r=$(window).width(),i=$(window).height();e.left+t+n>r&&this.$cm.addClass("right-anchor"),this.updatePosition(),this.$cm.trigger("show")},this)),$(document).on("click",$.proxy(function(e){!this.$node.is(e.target)&&!$.contains(this.$cm[0],e.target)&&this.$cm.trigger("hide")},this)),$(document).on("keyup",$.proxy(function(e){e.keyCode===27&&this.$cm.trigger("hide")},this))})}return e.create("contextMenuIndicator",n)}),define("components/dashboard/overview_panel",["components/component_manager","components/mixin/container","components/context_menu_indicator"],function(e,t,n){function r(){this.defaultAttrs({insertionPoint:".overview-content",title:"",count:10,countClass:"blue"}),this.createOverviewHeader=function(){this.$headerNode=$("<div>").addClass("overview-header"),this.$countNode=$("<span>").addClass("overview-count").appendTo(this.$headerNode).html(this.attr.count),this.$titleNode=$("<span>").addClass("overview-title").appendTo(this.$headerNode).html(this.attr.title),this.$headerNode.appendTo(this.$node),this.$contentNode=$("<div>").addClass("overview-content").appendTo(this.$node),this.attr.contextMenu&&(this.cmIndicator=$("<div>").appendTo(this.$headerNode),n.attachTo(this.cmIndicator,this.attr))},this.after("initialize",function(){this.$node.addClass("sidebar"),this.createOverviewHeader()})}return window.aa=e,e.create("overviewPanel",r,t)}),define("components/dashboard/dashboard",["components/component_manager","components/mixin/container","components/mixin/data_binding","components/container","components/dashboard/overview_panel"],function(e,t,n){function r(){this.defaultAttrs({}),this.updateData=function(){this.attr.data($.proxy(function(e){this.$node.data("value",e)},this))},this.after("initialize",function(){this.before("renderItems",function(){this.attr.items=[{component:"container",className:"main-content",items:this.attr.mainContent},{component:"overviewPanel",title:this.attr.overviewPanel.title,contextMenu:this.attr.overviewPanel.contextMenu,items:this.attr.overviewPanel.items}]}),this.after("renderItems",function(){this.updateData()})})}return e.create("dashboard",r,t,n)});